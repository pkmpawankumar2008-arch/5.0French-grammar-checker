// server.js
import express from 'express';
import fetch from 'node-fetch';
import path from 'path';
import { fileURLToPath } from 'url';

const app = express();
app.use(express.json());

const LT_URL = 'https://api.languagetool.org/v2/check'; // or your self-hosted server

app.post('/api/check', async (req, res) => {
  try {
    const { text, language = 'fr' } = req.body || {};
    const form = new URLSearchParams();
    form.set('text', text || '');
    form.set('language', language);
    // Optional: French-specific options can be added here

    const r = await fetch(LT_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: form.toString()
    });

    const data = await r.json();
    res.status(r.status).json(data);
  } catch (e) {
    res.status(500).json({ error: 'proxy_failed' });
  }
});

// serve static
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
app.use(express.static(__dirname));

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log('Listening on ' + PORT));